# -*- coding: utf-8 -*-
"""Cricket_task.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1R7xNgzMcjzmfNwjvuDED-wz72c6HbPsZ

This Notebook is created as part of assignment for selection of the Position of Intern at India in Pixels


The environment used in Google's Collaboratory
"""

from google.colab import drive
drive.mount('/content/drive/')

#Create a folder by name 'cricket' in your google drive
# %cd '/content/drive/My Drive/cricket'
# %ls

import pandas as pd  # file operations
from bs4 import BeautifulSoup  #Scrapping tool
from urllib.request import urlopen as ureq # For requesting data from link
import numpy as np
import re
import csv

"""##Task 1 --- Listing Names of all players who have played the GAME of ODI cricket"""

##Writing a generic Scraping Function
def scrap_names(x):
    #global soup
    x_in = x
    x = chr(x)#to change integer into character

    url = "http://howstat.com/cricket/Statistics/Players/PlayerList.asp?Group={}".format(x)
    pagehtml = ureq(url)
    soup = BeautifulSoup(pagehtml,"html.parser") #parse the html
    table = soup.find("table", { "class" : "TableLined" })
    
    with open('AZ.csv', 'a', newline='') as csvfile:
      f = csv.writer(csvfile) 
      for x in table:
        rows = table.find_all('tr') #find all tr tag(rows)
      
      if x_in == 65:
        rows = rows[1:-1]
        
      elif x_in > 65 :
        rows = rows[2:-1]
      
      
      for tr in rows:
        data=[]
        cols = tr.find_all('td') #find all td tags(columns)
        for td in cols:
            data.append(td.text.strip()) 
        f.writerow(data)
        print(data)
        
    print('Completed {}'.format(x_in))

#Getting all the data now from A(65)-Z(90)
for i in range(65,91):
  scrap_names(i)

#Handling the Missing Values using Pandas
#so that unnecessary row is removed
#AZ contains All international Players Names
#AZ2 contains Preprocessed and cleaned data

df = pd.read_csv("AZ.csv",header = 0)
df = df.drop('Tests', axis=1)
df = df.drop("T20s", axis=1)
df = df.drop("Born", axis=1)
df['ODIs'].fillna(0, inplace=True)
shape = df.shape

df.to_csv('AZ2.csv', index=False)

# #Getting the list of all ODI players
with open('AZ2.csv') as csvDataFile:
  data=list(csv.reader(csvDataFile))

  # #converting the data to list so we can access it easily
  print ("The Players who Played ODI and the no. of times they played are:")
  print("-------------------------------------------------------")  
  for i in range(1,shape[0]):
    if data[i][2]!= "0.0":
      print(data[i][0],data[i][2])
